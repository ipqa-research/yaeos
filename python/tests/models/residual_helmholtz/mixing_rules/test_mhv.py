import numpy as np

from yaeos import MHV, NRTL, PengRobinson76


def test_mhv_volume():
    vs = [
        3.8954454599002986e-002,
        4.0147640893006223e-002,
        4.1776326021498014e-002,
        4.4097984428987276e-002,
        16.262931191741700,
        18.425551273289319,
        20.567248364582973,
        22.694579472830235,
        24.811636695923291,
        26.921111037283183,
    ]

    ts = [200.0, 250.0, 300.0, 350.0, 400.0, 450.0, 500.0, 550.0, 600.0, 650.0]

    nrtl = NRTL(
        [[0.0, 3.458], [-0.801, 0.0]],
        [[0.0, -586.1], [246.2, 0.0]],
        [[0.0, 0.3], [0.3, 0.0]],
    )

    mixing = MHV(nrtl, -0.53)

    model = PengRobinson76(
        [647.13999999999999, 513.91999999999996],
        [220.63999999999999, 61.479999999999997],
        [0.34399999999999997, 0.64900000000000002],
        mixing,
    )

    for t, vol in zip(ts, vs):
        v = model.volume([0.5, 0.5], 2.0, t)

        assert np.allclose(v, vol, atol=1e-6)


def test_mhv_pressure():
    p_f = [
        0.84360808451997393,
        1.0764241819538152,
        1.3082675236082266,
        1.5393906683044574,
        1.7699520496208128,
        2.0000589281992078,
        2.2297880072979779,
        2.4591964400656625,
        2.6883281965214660,
        2.9172179816847454,
    ]

    dpdv_f = [
        -4.2601859623761291e-002,
        -5.5626370332162070e-002,
        -6.8545498238068506e-002,
        -8.1386604120969847e-002,
        -9.4166851769397750e-002,
        -0.10689786118837437,
        -0.11958794197059991,
        -0.13224328576159514,
        -0.14486865602198132,
        -0.15746781249523967,
    ]

    ts = [200.0, 250.0, 300.0, 350.0, 400.0, 450.0, 500.0, 550.0, 600.0, 650.0]

    nrtl = NRTL(
        [[0.0, 3.458], [-0.801, 0.0]],
        [[0.0, -586.1], [246.2, 0.0]],
        [[0.0, 0.3], [0.3, 0.0]],
    )

    mixing = MHV(nrtl, -0.53)

    model = PengRobinson76(
        [647.13999999999999, 513.91999999999996],
        [220.63999999999999, 61.479999999999997],
        [0.34399999999999997, 0.64900000000000002],
        mixing,
    )

    v = 18.425

    for i, t in enumerate(ts):
        p, dp = model.pressure([0.5, 0.5], v, t, dv=True)

        assert np.allclose(p, p_f[i], atol=1e-6)
        assert np.allclose(dp["dv"], dpdv_f[i], atol=1e-6)
